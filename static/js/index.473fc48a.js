(()=>{"use strict";var e,t,r,s,n={269:function(e,t,r){var s=r(848),n=r(540),l=r(338);let a=[{value:"almaty",label:"Алматы"},{value:"astana",label:"Астана"},{value:"shymkent",label:"Шымкент"},{value:"pavlodar",label:"Павлодар"}],o=e=>{let{selectedCity:t,onCityChange:r,onShowMap:n,mapLoading:l}=e;return(0,s.jsxs)("header",{className:"text-center mb-8 py-5 bg-gradient-to-r from-gray-800 to-blue-700 text-white rounded-lg shadow-card",children:[(0,s.jsx)("h1",{className:"text-4xl font-bold mb-2",children:"Курсы обмена Нурболата"}),(0,s.jsx)("p",{className:"text-lg opacity-90",children:"Актуальные курсы обмена CNY, TRY и RUB в Казахстане"}),(0,s.jsxs)("div",{className:"mt-6 flex justify-center items-center space-x-12",children:[(0,s.jsx)("select",{value:t,onChange:e=>r(e.target.value),className:"px-4 py-2 rounded-lg bg-white text-gray-800 shadow-button border-none focus:outline-none focus:ring-2 focus:ring-blue-500",children:a.map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value))}),(0,s.jsxs)("button",{onClick:n,className:"bg-white text-blue-700 px-4 py-2 rounded-lg font-medium hover:bg-gray-100 transition-colors flex items-center space-x-2",disabled:l,children:[l?(0,s.jsxs)("svg",{className:"w-5 h-5 animate-spin text-blue-700",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})]}):(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})}),(0,s.jsx)("span",{children:l?"Загрузка...":"Карта"})]})]})]})},c=[{value:"cny",label:"Китайский юань (CNY)"},{value:"try",label:"Турецкая лира (TRY)"},{value:"rub",label:"Российский рубль (RUB)"}],i=e=>{let{activeCurrency:t,onCurrencyChange:r}=e;return(0,s.jsx)("div",{className:"flex justify-center mb-5 flex-wrap",children:c.map(e=>(0,s.jsx)("button",{onClick:()=>r(e.value),className:`px-6 py-3 mx-1 mb-2 cursor-pointer font-bold transition-all duration-300 rounded-t-lg ${t===e.value?"bg-blue-600 text-white":"bg-gray-300 text-gray-700 hover:bg-gray-400"}`,children:e.label},e.value))})},d=e=>{let{point:t,currency:r,clickedPhones:n,onPhoneClick:l}=e,a=t.courses[r.toUpperCase()],o=a?a[0]:"Н/Д",c=a?a[1]:"Н/Д";return(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-card p-5 transition-transform duration-300 hover:transform hover:-translate-y-1",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start mb-4 pb-3 border-b border-gray-200",children:[(0,s.jsxs)("div",{className:"text-2xl font-bold text-gray-800",children:[(0,s.jsx)("span",{className:"text-green-600",children:o})," /"," ",(0,s.jsx)("span",{className:"text-red-600",children:c})]}),(0,s.jsx)("div",{className:"text-xs text-gray-400 mt-1.5",children:t.actualTime})]}),(0,s.jsx)("div",{className:"font-medium mb-3 text-gray-700",children:t.address||""}),(0,s.jsx)("div",{className:"mb-4",children:t.phones.map(e=>(0,s.jsx)("a",{href:`tel:${e}`,onClick:()=>l(e),className:`inline-block bg-blue-50 px-3 py-1 rounded-full mr-2 mb-2 transition-colors ${n.has(e)?"text-green-600":"text-blue-600 hover:text-blue-800"}`,children:e},e))})]})},u=e=>{let{lastUpdate:t}=e;return(0,s.jsxs)("div",{className:"text-center mt-5 text-gray-500 text-sm",children:["Последнее обновление: ",t]})};var x=r(786),h=r(889),p=r(257),m=r(137),b=r(481),g=r.n(b);r(292);let f=new(g()).Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),y=new(g()).Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),j=new(g()).Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]});function v(e){let{isOpen:t,onClose:r,points:n,city:l,currency:a,center:o,subsetIdx:c}=e;return(console.log("-----",n),t)?n&&0!==n.length?(console.log("+++++++ ",o),(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-lg w-11/12 max-w-4xl h-5/6 flex flex-col",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center p-4 border-b",children:[(0,s.jsxs)("h2",{className:"font-bold text-lg",children:["Карта (",l.toUpperCase(),", ",a.toUpperCase(),")"]}),(0,s.jsx)("button",{onClick:r,className:"text-red-500 font-bold",children:"✕"})]}),(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsxs)(x.W,{center:[o.lat,o.lng],zoom:12,style:{height:"100%",width:"100%"},children:[(0,s.jsx)(h.e,{attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a>',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),n.map((e,t)=>(0,s.jsx)(p.p,{position:[e.lat,e.lng],icon:c.indexOf(t)>=0?y:j,children:(0,s.jsxs)(m.z,{children:[(0,s.jsxs)("span",{children:[`${e.name}-${e.address}`,(0,s.jsx)("br",{})]}),e.phones.map(e=>(0,s.jsx)("a",{href:`tel:${e}`,className:"inline-block bg-blue-50 px-3 py-1 rounded-full mr-2 mb-2 transition-colors text-blue-600 hover:text-blue-800",children:e},e))]})},t)),(0,s.jsx)(p.p,{position:[o.lat,o.lng],icon:f,children:(0,s.jsx)(m.z,{children:"Центр"})})]})})]})})):(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-lg w-11/12 max-w-4xl h-5/6 flex flex-col",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center p-4 border-b",children:[(0,s.jsxs)("h2",{className:"font-bold text-lg",children:["Карта (",l.toUpperCase(),", ",a.toUpperCase(),")"]}),(0,s.jsx)("button",{onClick:r,className:"text-red-500 font-bold",children:"✕"})]}),(0,s.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,s.jsx)("p",{className:"text-gray-600",children:"Нет точек для отображения"})})]})}):null}let w=()=>new Date().toLocaleTimeString("kk-KZ"),N=document.getElementById("root");if(!N)throw Error("Root container not found");(0,l.createRoot)(N).render((0,s.jsx)(()=>{let[e,t]=(0,n.useState)("almaty"),[r,l]=(0,n.useState)("cny"),[a,c]=(0,n.useState)(w()),[x,h]=(0,n.useState)({}),[p,m]=(0,n.useState)({subsetIdx:[null],center:{lat:0,lng:0},isOpen:!1,points:[],city:"almaty",currency:"cny"}),[b,g]=(0,n.useState)(!1),{data:f,error:y,isConnected:j}=((e,t)=>{let[r,s]=(0,n.useState)([]),[l,a]=(0,n.useState)(null),[o,c]=(0,n.useState)(!1),i=(0,n.useRef)(null);return(0,n.useEffect)(()=>{let r=`https://exchangerback.onrender.com/api/exchange/sse/punkts/${e}/${t}`;i.current&&i.current.close(),a(null),c(!1),s([]),i.current=new EventSource(r),i.current.onmessage=e=>{try{let t=JSON.parse(e.data);if(t&&t.error)return void a(t.error);Array.isArray(t)?(s(t),c(!0)):t&&Array.isArray(t.points)?(s(t.points),c(!0)):(a("Неверный формат данных"),console.error("Неверный формат данных:",t))}catch(e){a("Ошибка обработки данных"),console.error("Ошибка обработки данных:",e)}},i.current.onerror=e=>{console.error("SSE ошибка:",e),a("Ошибка соединения"),c(!1),setTimeout(()=>{var e;(null==(e=i.current)?void 0:e.readyState)===EventSource.CLOSED&&n()},5e3)};let n=()=>{i.current=new EventSource(r)};return()=>{i.current&&(i.current.close(),i.current=null)}},[e,t]),{data:r,error:l,isConnected:o}})(e,r),N=(0,n.useCallback)(t=>{let s=`${e}_${r}`;h(e=>{let r=new Set(e[s]||[]);return r.add(t),{...e,[s]:r}})},[e,r]),k=(0,n.useCallback)(async()=>{g(!0);try{let t=await fetch(`https://exchangerback.onrender.com/api/exchange/punkts/${e}?currency=${r.toLocaleUpperCase()}`),s=await t.json(),n=s.map(t=>({id:`${e}-${t.name}`,...t})),l=await fetch("https://exchangerback.onrender.com/api/circle/min-circle",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({points:n})}),a=await l.json();console.log("+++=====+",a),m({subsetIdx:a.subsetIdx,center:a.center,isOpen:!0,points:s,city:e,currency:r})}catch(e){console.error("Failed to fetch map points:",e)}finally{g(!1)}},[e,r]),C=(0,n.useCallback)(()=>{m(e=>({...e,isOpen:!1}))},[]),S=(0,n.useCallback)(()=>{c(w())},[]);n.useEffect(()=>{j&&f.length>0&&S()},[j,f,S]),n.useEffect(()=>{let e=setInterval(S,6e4);return()=>clearInterval(e)},[S]);let O=x[`${e}_${r}`]||new Set;return(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 text-gray-800 p-5",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,s.jsx)(o,{selectedCity:e,onCityChange:t,onShowMap:k,mapLoading:b}),(0,s.jsx)(i,{activeCurrency:r,onCurrencyChange:l}),(0,s.jsx)("div",{className:"mb-8",children:y?(0,s.jsxs)("div",{className:"text-center py-5 font-bold text-red-600",children:["Ошибка: ",y]}):j?0===f.length?(0,s.jsx)("div",{className:"text-center py-5 font-bold text-blue-600",children:"Нет данных для отображения"}):(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5",children:f.map((e,t)=>(0,s.jsx)(d,{point:e,currency:r,clickedPhones:O,onPhoneClick:N},`${e.address}-${t}`))}):(0,s.jsx)("div",{className:"text-center py-5 font-bold text-blue-600",children:"Загрузка данных..."})}),(0,s.jsx)(u,{lastUpdate:a}),(0,s.jsx)(v,{isOpen:p.isOpen,onClose:C,points:p.points,city:p.city,currency:p.currency,center:p.center,subsetIdx:p.subsetIdx})]})})},{}))}},l={};function a(e){var t=l[e];if(void 0!==t)return t.exports;var r=l[e]={exports:{}};return n[e].call(r.exports,r,r.exports,a),r.exports}a.m=n,a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e=[],a.O=(t,r,s,n)=>{if(r){n=n||0;for(var l=e.length;l>0&&e[l-1][2]>n;l--)e[l]=e[l-1];e[l]=[r,s,n];return}for(var o=1/0,l=0;l<e.length;l++){for(var[r,s,n]=e[l],c=!0,i=0;i<r.length;i++)(!1&n||o>=n)&&Object.keys(a.O).every(e=>a.O[e](r[i]))?r.splice(i--,1):(c=!1,n<o&&(o=n));if(c){e.splice(l--,1);var d=s();void 0!==d&&(t=d)}}return t},t={410:0},a.O.j=e=>0===t[e],r=(e,r)=>{var s,n,[l,o,c]=r,i=0;if(l.some(e=>0!==t[e])){for(s in o)a.o(o,s)&&(a.m[s]=o[s]);if(c)var d=c(a)}for(e&&e(r);i<l.length;i++)n=l[i],a.o(t,n)&&t[n]&&t[n][0](),t[n]=0;return a.O(d)},(s=self.webpackChunkcurrency_exchange_app=self.webpackChunkcurrency_exchange_app||[]).forEach(r.bind(null,0)),s.push=r.bind(null,s.push.bind(s));var o=a.O(void 0,["783","206"],function(){return a(269)});o=a.O(o)})();